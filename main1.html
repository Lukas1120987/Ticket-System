<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¢ FunPark â€“ Ultimate Static System</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
 --bg:#f4f6f9;--card:#fff;--primary:#1976d2;--accent:#ff9800;
 --text:#222;--good:#4caf50;--bad:#f44336;
}
body.dark{
 --bg:#0f1115;--card:#1e222b;--text:#eee;
}

*{box-sizing:border-box;font-family:Montserrat;margin:0}
body{background:var(--bg);color:var(--text);transition:.3s}

header{
 background:linear-gradient(135deg,var(--primary),#0d47a1);
 color:#fff;padding:1.2rem;text-align:center
}

nav{margin-top:1rem;display:flex;justify-content:center;gap:.6rem;flex-wrap:wrap}
nav button{
 border:none;border-radius:999px;padding:.6rem 1rem;font-weight:600
}

main{
 max-width:1200px;margin:2rem auto;background:var(--card);
 padding:2rem;border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,.25)
}

section{display:none}
section.active{display:block}

h2{color:var(--primary);margin-bottom:1rem}

.card{
 background:var(--bg);padding:1.5rem;border-radius:16px;
 box-shadow:0 4px 15px rgba(0,0,0,.15);margin-top:1rem
}

form{display:flex;flex-direction:column;gap:1rem}
input,select{
 padding:.8rem;border-radius:10px;border:1px solid #ccc
}

button.primary{
 background:var(--primary);color:#fff;border:none;
 padding:.9rem;border-radius:12px;font-weight:700
}
button.secondary{
 background:transparent;border:2px solid var(--primary);
 color:var(--primary);padding:.7rem;border-radius:12px
}

.ticket{
 position:relative;margin-top:1rem
}
.badge{
 position:absolute;top:1rem;right:1rem;
 padding:.3rem .7rem;border-radius:999px;
 font-size:.75rem;font-weight:700
}

.good{background:var(--good);color:#fff}
.bad{background:var(--bad);color:#fff}

#scanner{
 background:#000;color:#0f0;font-family:monospace;
 padding:1rem;border-radius:12px
}

.toast{
 position:fixed;bottom:20px;left:50%;
 transform:translateX(-50%);
 background:var(--primary);color:#fff;
 padding:.8rem 1.2rem;border-radius:999px;
 opacity:0;transition:.3s
}
.toast.show{opacity:1}

.fab{
 position:fixed;right:20px;bottom:20px;
 width:50px;height:50px;border-radius:50%;
 border:none;background:var(--accent);font-size:1.4rem
}
</style>
</head>

<body>

<header>
<h1>ğŸ¢ FunPark</h1>
<p>VollstÃ¤ndiges statisches Ticketsystem</p>
<nav>
<button onclick="go('home')">Start</button>
<button onclick="go('buy')">Tickets</button>
<button onclick="go('my')">Meine Tickets</button>
<button onclick="go('scan')">Scanner-Login</button>
</nav>
</header>

<main>

<section id="home" class="active">
<h2>Willkommen</h2>
<div class="card">ğŸŸï¸ Kaufen â€¢ ğŸ’³ Bezahlen â€¢ ğŸ“± Scannen â€¢ âŒ Entwerten</div>
</section>

<section id="buy">
<h2>ğŸŸï¸ Ticket kaufen</h2>
<form id="buyForm">
<select id="user">
<option>Max</option><option>Anna</option><option>Tom</option><option>Lea</option>
</select>
<select id="ticket">
<option value="Tagesticket|35">Tagesticket â€“ 35â‚¬</option>
<option value="VIP|150">VIP â€“ 150â‚¬</option>
</select>
<button class="primary">Zur Zahlung ğŸ”</button>
</form>
</section>

<section id="my">
<h2>ğŸ’³ Meine Tickets</h2>
<select id="viewUser">
<option>Max</option><option>Anna</option><option>Tom</option><option>Lea</option>
</select>
<button class="secondary" onclick="loadTickets()">Anzeigen</button>
<div id="ticketList"></div>
</section>

<section id="scan">
<h2>ğŸ” Scanner-Login</h2>

<div class="card">
<input id="scanInput" placeholder="Ticketcode eingeben">
<button class="primary" onclick="scanCode()">Ticket prÃ¼fen</button>
</div>

<div class="card">
<div id="reader" style="width:100%"></div>
</div>

<div id="scanner"></div>
</section>

</main>

<button class="fab" onclick="toggleDark()">ğŸŒ™</button>
<div class="toast" id="toast"></div>

<script>
let tickets=JSON.parse(localStorage.getItem("tickets"))||[];

function go(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

/* ===== TOAST ===== */
function toast(msg){
 const t=document.getElementById("toast");
 t.textContent=msg;t.classList.add("show");
 setTimeout(()=>t.classList.remove("show"),2500);
}

/* ===== BUY & PAYMENT ===== */
buyForm.onsubmit=e=>{
 e.preventDefault();
 const [type,price]=ticket.value.split("|");
 localStorage.setItem("pending",JSON.stringify({user:user.value,type,price}));
 openPayment();
};

function openPayment(){
 const w=window.open("","_blank");
 w.document.write(`
 <h2>ğŸ”’ PayFun Secure</h2>
 <p id="info"></p>
 <progress max="100" value="0" id="p"></progress><br><br>
 <button onclick="pay()">Jetzt bezahlen</button>
 <script>
 const d=JSON.parse(localStorage.getItem("pending"));
 info.innerHTML=d.type+" â€“ <b>"+d.price+"â‚¬</b>";
 let v=0;const i=setInterval(()=>{p.value=v+=20;if(v>=100)clearInterval(i)},250);
 function pay(){
  const code="TCK-"+crypto.getRandomValues(new Uint32Array(1))[0].toString(16);
  const t=JSON.parse(localStorage.getItem("tickets"))||[];
  t.push({...d,code,redeemed:false});
  localStorage.setItem("tickets",JSON.stringify(t));
  alert("Zahlung erfolgreich");
  window.close();
 }
 <\/script>
 `);
}

/* ===== TICKETS ===== */
function loadTickets(){
 ticketList.innerHTML="";
 tickets=JSON.parse(localStorage.getItem("tickets"))||[];
 tickets.filter(t=>t.user===viewUser.value).forEach(t=>{
  const div=document.createElement("div");
  div.className="card ticket";
  div.innerHTML=`
   <span class="badge ${t.redeemed?"bad":"good"}">
    ${t.redeemed?"Entwertet":"GÃ¼ltig"}
   </span>
   <b>${t.code}</b><br>${t.type} â€“ ${t.price}â‚¬
   <div id="qr${t.code}"></div>
  `;
  ticketList.appendChild(div);
  new QRCode(document.getElementById("qr"+t.code),t.code);
 });
}

/* ===== SCANNER ===== */
function scanCode(code){
 if(!code) code=scanInput.value.trim();
 const t=tickets.find(x=>x.code===code);
 const out=document.getElementById("scanner");
 if(!t){out.textContent="âŒ Ticket ungÃ¼ltig";return;}
 if(t.redeemed){out.textContent="âš ï¸ Ticket bereits entwertet";return;}
 t.redeemed=true;
 localStorage.setItem("tickets",JSON.stringify(tickets));
 out.textContent="âœ… Ticket akzeptiert & entwertet";
 toast("Zutritt erlaubt");
}

/* QR Kamera */
new Html5Qrcode("reader").start(
 {facingMode:"environment"},
 {fps:10,qrbox:250},
 txt=>scanCode(txt)
);

/* ===== DARK ===== */
function toggleDark(){
 document.body.classList.toggle("dark");
}
</script>

</body>
</html>
