<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>üé¢ FunPark ‚Äì Statisches Ticketsystem (Abiturprojekt)</title>

<!-- ================= FONTS & LIBRARIES ================= -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
/* ================= THEME ================= */
:root{
  --bg:#f4f6fa;
  --card:#ffffff;
  --primary:#1976d2;
  --accent:#ff9800;
  --text:#1f1f1f;
  --muted:#666;
  --success:#4caf50;
  --error:#f44336;
}

body.dark{
  --bg:#0f1115;
  --card:#1c1f26;
  --primary:#90caf9;
  --accent:#ffb74d;
  --text:#eaeaea;
  --muted:#aaa;
}

/* ================= BASE ================= */
*{box-sizing:border-box;font-family:Montserrat;margin:0;padding:0}
body{background:var(--bg);color:var(--text);min-height:100vh}
button{cursor:pointer}

/* ================= HEADER ================= */
header{
  background:linear-gradient(135deg,var(--primary),#0d47a1);
  color:#fff;
  padding:1.4rem;
  text-align:center;
  box-shadow:0 4px 20px rgba(0,0,0,.3);
}

nav{
  margin-top:1rem;
  display:flex;
  justify-content:center;
  gap:.6rem;
  flex-wrap:wrap;
}

nav button{
  border:none;
  padding:.6rem 1.1rem;
  border-radius:999px;
  font-weight:600;
}

/* ================= MAIN ================= */
main{
  max-width:1200px;
  margin:2rem auto;
  padding:2rem;
  background:var(--card);
  border-radius:22px;
  box-shadow:0 10px 40px rgba(0,0,0,.25);
}

section{display:none}
section.active{display:block}

/* ================= COMPONENTS ================= */
h2{color:var(--primary);margin-bottom:1rem}

.card{
  background:var(--bg);
  padding:1.5rem;
  border-radius:16px;
  box-shadow:0 4px 15px rgba(0,0,0,.15);
  margin-top:1rem;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:1.5rem;
}

/* ================= FORMS ================= */
form{display:flex;flex-direction:column;gap:1rem}
input,select{
  padding:.8rem;
  border-radius:10px;
  border:1px solid #ccc;
  font-size:1rem;
}

button.primary{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:.9rem;
  border-radius:12px;
  font-weight:700;
}

button.secondary{
  background:transparent;
  border:2px solid var(--primary);
  color:var(--primary);
  padding:.7rem;
  border-radius:12px;
}

/* ================= TICKET ================= */
.ticket{position:relative}
.badge{
  position:absolute;
  top:1rem;
  right:1rem;
  padding:.35rem .7rem;
  border-radius:999px;
  font-size:.75rem;
  font-weight:700;
}
.valid{background:var(--success);color:#fff}
.used{background:var(--error);color:#fff}

/* ================= SCANNER ================= */
#gate{
  height:200px;
  border-radius:16px;
  border:5px solid #ccc;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:2rem;
  font-weight:700;
  margin-bottom:1rem;
}
.gate-ok{border-color:var(--success);color:var(--success)}
.gate-bad{border-color:var(--error);color:var(--error)}

/* ================= FLOATING ================= */
.fab{
  position:fixed;
  right:20px;
  bottom:20px;
  width:55px;
  height:55px;
  border-radius:50%;
  border:none;
  background:var(--accent);
  font-size:1.4rem;
}
</style>
</head>

<body>

<header>
  <h1>üé¢ FunPark</h1>
  <p>Statisches Ticketsystem ‚Äì Informatik Abiturprojekt</p>
  <nav>
    <button onclick="go('home')">Start</button>
    <button onclick="go('buy')">Tickets kaufen</button>
    <button onclick="go('my')">Meine Tickets</button>
    <button onclick="go('scan')">Scanner</button>
  </nav>
</header>

<main>

<section id="home" class="active">
  <h2>Willkommen</h2>
  <div class="grid">
    <div class="card">üéüÔ∏è Ticketverwaltung</div>
    <div class="card">üí≥ Realistische Zahlung (Demo)</div>
    <div class="card">üì± QR-Scanner & Entwertung</div>
  </div>
</section>

<section id="buy">
  <h2>üéüÔ∏è Ticket kaufen</h2>
  <form id="buyForm">
    <select id="user">
      <option>Max</option><option>Anna</option><option>Tom</option><option>Lea</option>
    </select>

    <select id="ticketType">
      <option value="Tagesticket|35">Tagesticket ‚Äì 35 ‚Ç¨</option>
      <option value="2-Tage-Ticket|60">2 Tage ‚Äì 60 ‚Ç¨</option>
      <option value="VIP-Ticket|150">VIP ‚Äì 150 ‚Ç¨</option>
    </select>

    <button class="primary">Zur Zahlung üîê</button>
  </form>
</section>

<section id="my">
  <h2>üí≥ Meine Tickets</h2>
  <select id="viewUser">
    <option>Max</option><option>Anna</option><option>Tom</option><option>Lea</option>
  </select>
  <button class="secondary" onclick="loadTickets()">Anzeigen</button>
  <div id="ticketList"></div>
</section>

<section id="scan">
  <h2>üîê Scanner (Einlass)</h2>
  <div id="gate">üü° Bereit</div>

  <div class="card">
    <input id="manualCode" placeholder="Ticketcode manuell eingeben">
    <button class="primary" onclick="validateTicket()">Pr√ºfen</button>
  </div>

  <div class="card"><div id="reader"></div></div>
</section>

</main>

<button class="fab" onclick="toggleDark()">üåô</button>

<script>
/* ================= STATE ================= */
let tickets = JSON.parse(localStorage.getItem("tickets")) || [];
let scanner = null;

/* ================= NAV ================= */
function go(id){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(id==="scan") startScanner();
}

/* ================= DARK MODE ================= */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
}
if(localStorage.getItem("dark")==="true") document.body.classList.add("dark");

/* ================= BUY ================= */
buyForm.addEventListener("submit",e=>{
  e.preventDefault();
  const [type,price]=ticketType.value.split("|");
  localStorage.setItem("pendingPayment",JSON.stringify({
    user:user.value,type,price
  }));
  openPayment();
});

/* ================= PAYMENT ================= */

function openPayment(){
  const w = window.open("", "_blank", "width=420,height=650");
  w.document.open();
  w.document.write(`
<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>PayFun Secure Checkout</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    font-family: Montserrat, sans-serif;
    background: #f5f7fa;
    margin: 0;
    padding: 0;
  }
  .card {
    max-width: 360px;
    margin: 3rem auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,.1);
    padding: 2rem;
  }
  h2 {
    margin-top: 0;
    text-align: center;
  }
  .secure {
    text-align: center;
    font-size: .9rem;
    color: #4caf50;
    margin-bottom: 1.5rem;
  }
  label {
    font-size: .8rem;
    font-weight: 600;
    display: block;
    margin-top: 1rem;
  }
  input {
    width: 100%;
    padding: .6rem;
    margin-top: .3rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: .9rem;
  }
  .row {
    display: flex;
    gap: .7rem;
  }
  button {
    width: 100%;
    margin-top: 1.8rem;
    padding: .8rem;
    font-size: 1rem;
    border: none;
    border-radius: 8px;
    background: #0066ff;
    color: #fff;
    cursor: pointer;
  }
  button:disabled {
    background: #9bbcff;
  }
  .loading {
    display: none;
    text-align: center;
    margin-top: 1rem;
    font-size: .9rem;
  }
</style>
</head>
<body>

<div class="card">
  <h2>üîí PayFun Checkout</h2>
  <div class="secure">Sichere Zahlung ¬∑ SSL verschl√ºsselt</div>

  <label>Karteninhaber</label>
  <input placeholder="Max Mustermann">

  <label>Kartennummer</label>
  <input placeholder="1234 5678 9012 3456" maxlength="19">

  <div class="row">
    <div>
      <label>G√ºltig bis</label>
      <input placeholder="MM/JJ" maxlength="5">
    </div>
    <div>
      <label>CVC</label>
      <input placeholder="123" maxlength="3">
    </div>
  </div>

  <button id="payBtn" onclick="pay()">Jetzt bezahlen</button>
  <div class="loading" id="loading">Zahlung wird verarbeitet‚Ä¶</div>
</div>

<script>
function pay(){
  document.getElementById("payBtn").disabled = true;
  document.getElementById("loading").style.display = "block";

  setTimeout(() => {
    const d = JSON.parse(localStorage.getItem("pendingPayment"));
    const t = JSON.parse(localStorage.getItem("tickets")) || [];
    const code = "TCK-" + Math.floor(100000 + Math.random() * 900000);

    t.push({
      ...d,
      code,
      redeemed: false,
      paidAt: new Date().toISOString()
    });

    localStorage.setItem("tickets", JSON.stringify(t));
    alert("‚úÖ Zahlung erfolgreich!\\nTicket-Code: " + code);
    window.close();
  }, 1800);
}
<\/script>

</body>
</html>
  `);
  w.document.close();
}

/* ================= TICKETS ================= */
function loadTickets(){
  tickets = JSON.parse(localStorage.getItem("tickets")) || [];
  ticketList.innerHTML="";
  tickets.filter(t=>t.user===viewUser.value).forEach(t=>{
    const d=document.createElement("div");
    d.className="card ticket";
    d.innerHTML=`
      <span class="badge ${t.redeemed?"used":"valid"}">
        ${t.redeemed?"ENTWERTET":"G√úLTIG"}
      </span>
      <b>${t.code}</b><br>${t.type} ‚Äì ${t.price} ‚Ç¨
      <div id="qr${t.code}"></div>
    `;
    ticketList.appendChild(d);
    new QRCode(document.getElementById("qr"+t.code),t.code);
  });
}

/* ================= SCANNER ================= */
function startScanner(){
  if(scanner) return;
  scanner=new Html5Qrcode("reader");
  scanner.start({facingMode:"environment"},{fps:10,qrbox:250},
    txt=>validateTicket(txt)
  );
}

function validateTicket(code){
  code = code || manualCode.value.trim();
  const gate=document.getElementById("gate");
  const t=tickets.find(x=>x.code===code);
  if(!t){gate.className="gate-bad";gate.textContent="‚ùå Ung√ºltig";return;}
  if(t.redeemed){gate.className="gate-bad";gate.textContent="‚ö†Ô∏è Bereits genutzt";return;}
  t.redeemed=true;
  localStorage.setItem("tickets",JSON.stringify(tickets));
  gate.className="gate-ok";
  gate.textContent="‚úÖ Zutritt erlaubt";
}
</script>

</body>
</html>
